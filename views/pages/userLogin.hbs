<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pets World Login Page</title>
    <link rel="stylesheet" href="../styles/userLogin.css" type="text/css">   
</head>
<body>
    {{#if flag}}
        <div class="popped"></div>
    {{/if}}
    <div class="wrapper">
        <div class="form">
            <div class="form-section-1">
                <div class="logo">
                    <div class="logo-img"><img src="https://media.istockphoto.com/id/1324471626/sv/vektor/dog-love-simple-logo.jpg?s=612x612&w=0&k=20&c=QQi-J8_cHY0RIdbZgC_nZeI6qGT2SsA52Fo1jUmewWs=" alt=""></div>
                    <h1>PETS WORLD</h1>
                </div>
                <form action="/login" method="POST">
                    <input type="text" name="emailMob" id="emailOrMobile" placeholder="Email Address/Mobile Number.." required>
                    <input type="password" name = "psswd" id="psswd" placeholder="Enter your password..">
                    <a href="#">Forgot password?</a>
                    <div class="btns">
                        <button type="submit" name="lgnBtn" value="regular-login" class="login-btn">LOGIN</button>
                        <button type="submit" name="lgnBtn" value="otp-login" class="login-btn">OTP LOGIN</button>
                    </div>
                    <a href="/register" style="font-size:1rem">Register ></a>
                </form>
                
            </div>
            <div class="form-section-2">
                <div class="sign-in">
                    <img src="https://www.freepnglogos.com/uploads/google-logo-png/google-logo-png-google-icon-logo-png-transparent-svg-vector-bie-supply-14.png" alt="">
                    <img src="https://www.freepnglogos.com/uploads/facebook-logo-icon/facebook-logo-clipart-flat-facebook-logo-png-icon-circle-22.png" alt="">
                </div>
            </div>
        </div>
        <div class="doggy">
            <img src="https://media-cldnry.s-nbcnews.com/image/upload/t_fit-1500w,f_auto,q_auto:best/rockcms/2022-08/220805-border-collie-play-mn-1100-82d2f1.jpg" alt="">
            <span class="title">
                LOGIN PAGE
            </span>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
<script>
    let emailOrMobile = document.getElementById("emailOrMobile");
    emailOrMobile.addEventListener("change",async function(){
         const value  = this.value.trim();
         const isValidEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
         const isValidMobile = /^\d{10}$/.test(value);
         this.setCustomValidity(''); // Reset any previous validation error
         let dataD= await fetch("/api/users");
         let data = await dataD.json();
         
         let user = data.users.find(val=>val.phoneNumber==value || val.email==value);
        console.log(user);
        if (value && !isValidEmail && !isValidMobile) {
            this.setCustomValidity('Please enter a valid email address or mobile number.');
        }
        if(user && user.isBlocked){
            this.setCustomValidity("You are Blocked")
            this.reportValidity();
        }
    
        if(!user){
            this.setCustomValidity('You Havenot Registered');
            this.reportValidity();
        }
    });
    /*let psswd = document.getElementById("psswd");
    psswd.addEventListener("change",async function(){
         const value  = this.value.trim();
         this.setCustomValidity(''); // Reset any previous validation error
         let dataD= await fetch("http://127.0.0.1:2000/api/users");
         let data = await dataD.json();
         let user = data.find(val=>val.psswd==value);
        if (!user) {
            this.setCustomValidity('Enter right Password Amigo!');
        }
         
    }); */
    if(document.querySelector(".popped")){
        Swal.fire({
        title: 'Error!',
        text: 'Check Your Password Amigo!',
        icon: 'error',
        confirmButtonText: 'OK'
    })
    }
</script>
</html>